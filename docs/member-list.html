<!DOCTYPE HTML>
<html>

<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5shiv.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
	<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
	<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
	<!--[if IE 6]>
<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>

<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
	<script type="text/javascript" src="lib/ueditor/1.4.3/ueditor.config.js"></script>
	<script type="text/javascript" src="lib/ueditor/1.4.3/ueditor.all.min.js">

	</script>
	<script type="text/javascript" src="lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>
	<script src="lib/js/ipconfig.js"></script>
	<script type="text/javascript" src="lib/js/page.js"></script>
	<!--	<script type="text/javascript" src="lib/js/jquery.params.js" ></script>-->
	<link rel="stylesheet" href="https://www.layui.com/admin/std/dist/layuiadmin/layui/css/layui.css">

	<style>
		/*分页样式*/

		#pagination ul {
			list-style: none;
			padding-left: 0;
			margin-top: 16px;
		}

		#pagination ul li {
			padding: 0 10px;
			vertical-align: top;
			display: inline-block;
			font-size: 14px;
			min-width: 36px;
			min-height: 28px;
			line-height: 28px;
			cursor: pointer;
			box-sizing: border-box;
			text-align: center;
			background-color: #ffffff;
			color: #606266;
			border-radius: 6px;
			margin: 0 1px;
			border: 1px solid #ebebeb;
			height: 30px;
		}

		#pagination ul li:hover {
			transform: scale(1.1);
			background-color: #F4F6F8;
		}

		#pagination li.active {
			background: #98A6AD;
			color: white;
			cursor: not-allowed;
		}

		#pagination li.disabled {
			cursor: not-allowed;
		}

		#pagination li.totalPage {
			background: transparent;
			cursor: default;
			border: none;
			padding: 0 6px;
		}

		#pagination li.totalPage:hover {
			transform: none;
			background-color: #ffffff;
		}


		#pagination li input {
			-webkit-appearance: none;
			background-color: #fff;
			background-image: none;
			border-radius: 4px;
			border: 1px solid #dcdfe6;
			box-sizing: border-box;
			color: #606266;
			display: inline-block;
			font-size: inherit;
			outline: none;
			padding: 3px 5px;
			transition: border-color .2s cubic-bezier(.645, .045, .355, 1);
			width: 40px;
			height: 25px;
			margin: 0 6px;
		}

		#pagination li input:focus {
			border-color: #98A6AD;
		}

		#pagination {
			user-select: none;
		}

		#pagination ul:nth-child(2) {
			border-radius: 6px;
		}

		input[type=number] {
			-moz-appearance: textfield;
		}

		input[type=number]::-webkit-inner-spin-button,
		input[type=number]::-webkit-outer-spin-button {
			-webkit-appearance: none;
			margin: 0;
		}
	</style>
	<title>会员列表</title>

</head>

<body>
	<nav class="breadcrumb"><i class="Hui-iconfont">&#xe67f;</i> 首页 <span class="c-gray en">&gt;</span> 会员管理 <span class="c-gray en">&gt;</span> 会员列表
		<a class="btn btn-success radius r" style="line-height:1.6em;margin-top:3px" href="javascript:location.replace(location.href);"
		 title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a></nav>
	<div class="page-container">
		<div class="text-c">
			<!--		<button onclick="removeIframe()" class="btn btn-primary radius">关闭选项卡</button>-->
			<!--	 <span class="select-box inline">-->
			<!--		<select name="" class="select">-->
			<!--			<option value="0">全部分类</option>-->
			<!--			<option value="1">分类一</option>-->
			<!--			<option value="2">分类二</option>-->
			<!--		</select>-->
			<!--		</span> -->


			<!--日期范围：
		<input type="text" onfocus="WdatePicker({ maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}' })" id="logmin" class="input-text Wdate" style="width:120px;">
		-
		<input type="text" onfocus="WdatePicker({ minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d' })" id="logmax" class="input-text Wdate" style="width:120px;">-->
			<input type="text" name="" id="jcbg_name" placeholder="会员名称" style="width:100px" class="input-text">
			<input type="text" name="" id="jcbg_phone" placeholder="手机号" style="width:100px" class="input-text">
			<input type="text" name="" id="jcbg_email" placeholder="邮箱" style="width:100px" class="input-text">
			<button name="" id="" class="btn btn-success" onclick="search_jcbgName()" type="submit"><i class="Hui-iconfont">&#xe665;</i> 搜索</button>
		</div>
		<div class="cl pd-5 bg-1 bk-gray mt-20"> <span class="l"><a href="javascript:;" id="plsc"  class="btn btn-danger radius"><i class="Hui-iconfont">&#xe6e2;</i> 批量删除</a> <a class="btn btn-primary radius" data-title="添加会员" data-href="member-add.html" onclick="Hui_admin_tab(this)" href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 添加会员</a></span>

		</div>



		<div class="mt-20">
			<div id="DataTables_Table_0_wrapper" class="dataTables_wrapper no-footer">
				<table class="table table-border table-bordered table-hover table-bg table-sort dataTable no-footer" id="DataTables_Table_0"
				 role="grid" aria-describedby="DataTables_Table_0_info">
					<thead>
						<tr class="text-c" role="row">
							<th width="25" class="sorting_disabled" rowspan="1" colspan="1" aria-label="" style="width: 25px;"><input type="checkbox" name="" value=""></th>
							<th width="80" rowspan="1" colspan="1" style="width: 80px;">用户名</th>
							<th width="90" rowspan="1" colspan="1" style="width: 90px;">手机号</th>
							<th width="90" rowspan="1" colspan="1" style="width: 90px;">邮箱</th>
							<th width="90" rowspan="1" colspan="1" style="width: 90px;">性别</th>
							<th width="100" class="sorting_disabled" rowspan="1" colspan="1" style="width: 100px;">操作</th>
						</tr>
					</thead>
					<tbody id="line_data"></tbody>
				</table>
				<!--分页开始-->
				<div id="pagination" style="text-align:center;display:none"></div>
				<p style="text-align:center;margin-top:6px;display:none;">(注：输入页码后，按回车键可跳转)</p>
				<!-- 分页结束 -->
			</div>
		</div>

	</div>
	<!--_footer 作为公共模版分离出去-->
	<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
	<!--/_footer 作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
	<!-- 时间插件 -->
	<script type="text/javascript" src="lib/js/jquery.params.js"></script>
	<script type="text/javascript">
		// 查询数据列表
		// 每页显示条数
		var pageSize = 10;
		// var currentPage=0
		//页面加载完成，异步请求
		window.onload = function () {
			// var pageSize=2;
			var currentPage = 0
			//初次加载页面 默认第一页为 0 每页 10
			selectInfPage(currentPage, pageSize);
		};

		function selectInfPage(currentPage, pageSize) {
			$.ajax({
				url: ip + "user/getUserListByPage.do", //查
				type: "get",
				data: {
					currentPage: currentPage,
					pageSize: pageSize //每页多少条
				},
				success: function (data) {
					console.log("ok");
					var zongshu = data.total; //数据总数
					console.log("总数=" + zongshu);
					//当数据总数大于0时，显示分页的样式
					if (zongshu > 0) {
						$("#p_desc").show();
						$("#pagination").show();
					}

					var pages = data.pages; //总页数
					var pagenums = data.pageNum; //当前页码
					if (pagenums == 0) {
						pagenums = 1
					}
					// var tiao = data.type; //每页显示条数
					var pageAmount = data.pageSize; //每页多少条
					new myPagination({
						// currentPage  	当前页数，默认0
						// pages            总页数
						// pageSize       	每页多少条
						// pageNum     		当前页码
						// pageSize       	每页多少条
						id: 'pagination',
						curPage: pagenums, //当前页码
						pageTotal: pages, //总页数
						pageAmount: pageAmount, //每页多少条
						dataTotal: zongshu, //总共多少条数据
						pageSize: 5, //显示一行页码数 默认 5
						showPageTotalFlag: true, //是否显示数据统计
						showSkipInputFlag: true, //是否支持跳转
						getPage: function (page) {
							//获取当前页数
							//console.log("我在这"+page);
							selectInfPage(page, pageSize);
						}
					});
					checkData(data);
				},

				error: function () {
					alert("查询失败");
				}
			});

		}

		function checkData(data) {
			console.log("恭喜你成功了");
			var html = '';
			for (var i = 0; i < data.list.length; i++) { //循环json对象，拼接tr,td的html
				//取出id
				var id = data.list[i].id;
				console.log(id);
				//取出标题
				var name = data.list[i].name;
				var phone = data.list[i].phone;
				var email = data.list[i].email;
				var sex = data.list[i].sex;

				html = html +
					'<tr  class="text-c odd" role="row" id="line_tr' + id + '">';
				html = html + '<td width="25px" style="text-align: center">';
				html = html + '<label>';
				html = html + '<input type="checkbox"  name="check" value=' + id + '>';
				html = html + '</label>';
				html = html + '</td>';
				//名称
				if (data.list[i].name != null) {
					html = html + '<td  id="name_td' + id + '">' + data.list[i].name + '' + '</td>';
				} else {
					html = html +
						'<td  id="name_td' + id + '">无数据</td>';
				}
				//手机号
				if (data.list[i].phone != null) {
					html = html + '<td  id="phone_td' + id + '">' + data.list[i].phone + '' + '</td>';
				} else {
					html = html +
						'<td  id="phone_td' + id + '">无数据</td>';
				}
				//Email
				if (data.list[i].email != null) {
					html = html + '<td  id="email_td' + id + '">' + data.list[i].email + '' + '</td>';
				} else {
					html = html +
						'<td  id="email_td' + id + '">无数据</td>';
				}
				//Sex
				if (data.list[i].sex != null) {
					html = html + '<td  id="sex_td' + id + '">' + data.list[i].sex + '' + '</td>';
				} else {
					html = html +
						'<td  id="sex_td' + id + '">无数据</td>';
				}
				html = html + '<td class="f-14 td-manage">';
				html = html + '<a title="编辑"  class="btn btn-xs btn-info" onclick="edit_only(' + id + ')"><i class="Hui-iconfont">&#xe6df;</i></a>';


				// html = html + '<a style="text-decoration:none" class="ml-5" onClick="article_edit("资讯编辑","article-edit.html",id)" href="javascript:;" title="编辑"></a> ';

				html = html + '<a style="text-decoration:none" class="ml-5" onClick="article_del(this,id)" href="javascript:;" title="删除"></a>';

				html = html + '<a title="删除" href="javascript:;" class="btn btn-xs  btn-warning" onclick="del_only(' + id + ')"><i class="Hui-iconfont">&#xe6e2;</i></a>';
				html = html + '</td>';
				html = html + '</tr>';
			}
			$('#line_data').html(html); //通过jquery方式获取table，并把tr,td的html输出到table中
		}


		/*资讯-添加*/
		function article_add(title, url, w, h) {
			var index = layer.open({
				type: 2,
				title: title,
				content: url
			});
			layer.full(index);
		}
		/*资讯-编辑*/
		function article_edit(title, url, id, w, h) {
			var index = layer.open({
				type: 2,
				title: title,
				content: url
			});
			layer.full(index);
		}


		/*资讯-审核*/
		function article_shenhe(obj, id) {
			layer.confirm('审核文章？', {
				btn: ['通过', '不通过', '取消'],
				shade: false,
				closeBtn: 0
			},
				function () {
					$(obj).parents("tr").find(".td-manage").prepend('<a class="c-primary" onClick="article_start(this,id)" href="javascript:;" title="申请上线">申请上线</a>');
					$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已发布</span>');
					$(obj).remove();
					layer.msg('已发布', { icon: 6, time: 1000 });
				},
				function () {
					$(obj).parents("tr").find(".td-manage").prepend('<a class="c-primary" onClick="article_shenqing(this,id)" href="javascript:;" title="申请上线">申请上线</a>');
					$(obj).parents("tr").find(".td-status").html('<span class="label label-danger radius">未通过</span>');
					$(obj).remove();
					layer.msg('未通过', { icon: 5, time: 1000 });
				});
		}
		/*资讯-下架*/
		function article_stop(obj, id) {
			layer.confirm('确认要下架吗？', function (index) {
				$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="article_start(this,id)" href="javascript:;" title="发布"><i class="Hui-iconfont">&#xe603;</i></a>');
				$(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已下架</span>');
				$(obj).remove();
				layer.msg('已下架!', { icon: 5, time: 1000 });
			});
		}

		/*资讯-发布*/
		function article_start(obj, id) {
			layer.confirm('确认要发布吗？', function (index) {
				$(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" onClick="article_stop(this,id)" href="javascript:;" title="下架"><i class="Hui-iconfont">&#xe6de;</i></a>');
				$(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已发布</span>');
				$(obj).remove();
				layer.msg('已发布!', { icon: 6, time: 1000 });
			});
		}
		/*资讯-申请上线*/
		function article_shenqing(obj, id) {
			$(obj).parents("tr").find(".td-status").html('<span class="label label-default radius">待审核</span>');
			$(obj).parents("tr").find(".td-manage").html("");
			layer.msg('已提交申请，耐心等待审核!', { icon: 1, time: 2000 });
		}


		//执行修改操作
		function edit_only(id) {
			var user_id = id;
			console.log("id=" + user_id);

			//原检测报告标题
			var old_name = $("#name_td" + id).text();
			console.log("标题=" + old_name);
			//手机号
			var old_phone = $("#phone_td" + id).text();
			//email
			var old_email = $("#email_td" + id).text();
			//Sex
			var old_sex = $("#sex_td" + id).text();

			//跳转至编辑页面
			window.open("member-edit.html?user_id=" + user_id, '_self');

		}


		//删除
		function del_only(id) {
			layer.confirm('确认要删除吗？', function () {
				$.ajax({
					url: ip + "user/del.do", //删除产品信息
					type: "post",
					data: {
						ids: id
					},
					dataType: "json",
					success: function (data) {
						//若有子节点，给出提示，无法删除
						if (data.ret == 0) {
							alert(data.msg);
						}
						//若无子节点，直接删除
						else if (data.ret == 1) {
							$("#line_tr" + id).remove(); //移除当前数据
							layer.msg('已删除!', { icon: 1, time: 1000 });
						}
					},
					error: function () {
						alert("删除失败");
					}
				})
			});
		}

		//批量删除开始
		$("#plsc").click(function () {

			var cks = document.getElementsByName("check");
			var str = "";

			if ($(":checkbox[name=check]:checked").size() != 0) {
				//拼接所有id
				for (var i = 0; i < cks.length; i++) {
					if (cks[i].checked) {
						str += cks[i].value + ",";
						// alert(str)
					}
				}
				//如果上面的条件成立，才进行删除操作
				var url = ip + "user/del.do";
				layer.confirm('您确定要删除该选中数据吗?', { btn: ['确定', '取消'], title: "提示" }, function () {
					$.ajax({
						type: "post",
						url: url,
						data: {
							ids: str
						},
						dataType: "json",
						async: false,
						success: function (data) {
							//window.location.reload();
							//若有子节点，提示无法删除
							if (data.ret == 0) {
								layer.msg('删除失败', { icon: 2 });
								alert(data.msg);
							}
							//若无子节点，删除当前选中的行
							else if (data.ret == 1) {
								layer.msg('删除成功', { icon: 1 });
								$(":checkbox[name=check]:checked").each(function () { // 遍历选中的checkbox
									trNumbers = $(this).parents("tr").index();  // 获取checkbox所在行的顺序
									$("#line_data").find("tr:eq(" + trNumbers + ")").remove();
								});
							}
						}
					});
				});

			} else {
				alert("请至少选择一条数据后再进行删除！");
			}
		})
		/*批量删除结束*/


		/*搜索开始*/
		function search_jcbgName() {
			//输入的文本值 线路名
			var jcbg_name = $("#jcbg_name").val();
			//console.log(jcbg_name);
			var jcbg_phone = $("#jcbg_phone").val();
			//console.log(jcbg_phone);
			var jcbg_email = $("#jcbg_email").val();
			//console.log(jcbg_email);
			$.ajax({
				url: ip + "user/getUserListByPage.do",//搜索接口
				type: 'get',
				dataType: 'json',
				data: {
					currentPage: 0,
					pageSize: 10,
					name: jcbg_name, //检测报告标题
					phone: jcbg_phone,
					email: jcbg_email
				},
				success: function (data) {
					/*搜索之后再次进行分页 开始*/
					var zongshu = data.total; //数据总数
					//当数据总数大于0时，显示分页的样式
					if (zongshu > 0) {
						$("#p_desc").show();
						$("#pagination").show();
					} else {
						$("#p_desc").hide();
						$("#pagination").hide();
					}
					var pages = data.pages; //总页数
					var pagenums = data.pageNum; //当前页数
					if (pagenums == 0) {
						pagenums = 1
					}
					var tiao = data.type; //每页显示条数
					var pageAmount = data.pageSize //每页多少条
					new myPagination({
						id: 'pagination',
						curPage: pagenums, //当前页码
						pageTotal: pages, //总页数
						pageAmount: pageAmount, //每页多少条
						dataTotal: zongshu, //总共多少条数据
						pageSize: 5, //显示一行页码数 默认 5
						showPageTotalFlag: true, //是否显示数据统计
						showSkipInputFlag: true, //是否支持跳转
						getPage: function (page) {
							//获取当前页数
							//console.log("我在这"+page);
							selectInfPage(page, pageSize);
						}
					})
					/*搜索之后再次进行分页 结束*/

					$("#line_data").empty();
					checkData(data);
				}
			});
		}
	/*搜索结束*/

	</script>
</body>

</html>