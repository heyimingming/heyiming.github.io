<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta name="renderer" content="webkit|ie-comp|ie-stand">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="Bookmark" href="/favicon.ico" >
	<link rel="Shortcut Icon" href="/favicon.ico" />
	<!--[if lt IE 9]>
	<script type="text/javascript" src="lib/html5shiv.js"></script>
	<script type="text/javascript" src="lib/respond.min.js"></script>
	<![endif]-->
	<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
	<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
	<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
	<!--[if IE 6]>
	<script type="text/javascript" src="lib/DD_belatedPNG_0.0.8a-min.js" ></script>
	<script>DD_belatedPNG.fix('*');</script>
	<![endif]-->
	<!--/meta 作为公共模版分离出去-->
	<script type="text/javascript" src="lib/js/ipconfig.js"></script>
	<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="lib/js/jquery.params.js" ></script>

	<!--<title>新增文章 - 资讯管理 - H-ui.admin v3.1</title>-->
	<!--_footer 作为公共模版分离出去-->

	<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.min.js"></script>
	<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer /作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script>
	<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.js"></script>
	<script type="text/javascript" src="lib/webuploader/0.1.5/webuploader.min.js"></script>
	<script type="text/javascript" src="lib/ueditor/1.4.3/ueditor.config.js"></script>
	<script type="text/javascript" src="lib/ueditor/1.4.3/ueditor.all.min.js"> </script>
	<script type="text/javascript" src="lib/ueditor/1.4.3/lang/zh-cn/zh-cn.js"></script>


	<title>新增检测报告 - 检测报告管理 - 检测报告信息管理系统v1.0</title>
	<meta name="keywords" content="河南四达检测技术有限公司,检测报告信息管理系统">
	<meta name="description" content="电力线路安全防护装置、在线检测装置及监控系统、电力仪器仪表、金属材料、矿物、环境、防雷检验、检测；无损检测；带电检测；">
	<style>
		/*检测报告样式*/
		.table-jian td{
			border: 1px solid #000;
			height: 40px;
			padding: 5px 10px;
		}
	</style>
</head>
<body>
<article class="page-container">
	<form method="post" id="form_edit" enctype="multipart/form-data">
	<div class="row cl">

		<input type="hidden" id="xian_id" name="id" > <!-- 一个隐藏的文本框 -->

		<label class="form-label col-xs-4 col-sm-2">检测报告标题：</label>
		<div class="formControls col-xs-8 col-sm-9">
			<input type="text" id="yuan-textTitle" class="input-text" value="检测报告标题" placeholder="" id="author" name="textTitle">
		</div>
	</div>
	<div class="row cl">
		<!--			<label class="form-label col-xs-4 col-sm-2">文章内容：</label>-->
		<label class="form-label col-xs-4 col-sm-2">检测报告内容：</label>
		<div class="formControls col-xs-8 col-sm-9">
			<!--				<script id="editor" type="text/plain" style="width:100%;height:400px;"></script> -->

				<script id="textarea2" name="editorValue" type="text/plain" style="width:100%;height:400px; margin-left:10px;"></script>
				<!-- 保存、取消按钮 start  注意保存、取消 要放在 form内部 -->

				<div style="margin-left: 10px;padding: 15px 15px 15px 0;">
					<button type="button" id="edit_submit" class="btn btn-primary" data-dismiss="modal">保存
					</button>
					<button onClick="removeIframe();" class="btn btn-default radius" type="button">取消</button>
				</div>
				<!-- 保存、取消按钮 end -->

		</div>
	</div>

	</form>
</article>


<script type="text/javascript">

	//来自上个页面传递过来的值
	var jcbg_id = $.query.get("jcbg_id");
	console.log('成功接收检测报告id=' + jcbg_id);

	$("#xian_id").val(jcbg_id);




	// var values = $.query.get("values");
	// console.log('成功富文本=' + values);
	//
	// var old_textTitle = $.query.get("old_textTitle");
	// console.log('成功标题=' + old_textTitle);

	//根据检测报告id查询该检测报告的标题和富文本编辑器里输入的信息

	var CCC = UE.getEditor(document.getElementById("textarea2"));

			$.ajax({
				type: "POST", //方法类型
				dataType: "json", //预期服务器返回的数据类型
				url: ip+"text/selectTextById.do", //url
				data: {
					id:jcbg_id
				},
				success: function (data) {

						//①检测报告标题回显
						var old_textTitle = data.textTitle;
						console.log("老标题="+old_textTitle);

						$("#yuan-textTitle").val(old_textTitle);

						//②富文本编辑器内容回显
						var values = data.editorValue;
						console.log("老内容="+values);
						//1初始化

						//2监听并回显
						$(function(){
							//判断ueditor 编辑器是否创建成功
							CCC.addListener("ready", function () {
								// editor准备好之后才可以使用
								CCC.setContent(values);
							});
						});
						//③
						//点击保存按钮执行修改操作
						$("#edit_submit").click(function () {
							$.ajax({
								type: "POST", //方法类型
								dataType: "json", //预期服务器返回的数据类型
								url: ip+"/text/update.do", //url
								data: $('#form_edit').serialize(),
								success: function (data) {
									//相应成功，修改失败
									if (data.ret == 0) {
										alert(data.msg);
									}
									//响应成功，修改成功
									else if (data.ret == 1) {
										// alert("服了")
										//修改界面，信息填写后，点击保存按钮跳转至列表页
										window.open("article-list.html",'_self');
									}
								},
								error: function () {
									alert("修改失败,后台发生异常，请重试！");
								}
							});
						});


				},
				error: function () {
					alert("修改失败,后台发生异常，请重试！");
				}
			});

</script>
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>